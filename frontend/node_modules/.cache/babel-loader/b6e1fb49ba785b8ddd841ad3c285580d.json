{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeMultisignedTx = exports.makeCompactBitArray = void 0;\n\nconst amino_1 = require(\"@cosmjs/amino\");\n\nconst encoding_1 = require(\"@cosmjs/encoding\");\n\nconst proto_signing_1 = require(\"@cosmjs/proto-signing\");\n\nconst multisig_1 = require(\"cosmjs-types/cosmos/crypto/multisig/v1beta1/multisig\");\n\nconst signing_1 = require(\"cosmjs-types/cosmos/tx/signing/v1beta1/signing\");\n\nconst tx_1 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\n\nconst tx_2 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\n\nconst long_1 = __importDefault(require(\"long\"));\n\nfunction makeCompactBitArray(bits) {\n  const byteCount = Math.ceil(bits.length / 8);\n  const extraBits = bits.length - Math.floor(bits.length / 8) * 8;\n  const bytes = new Uint8Array(byteCount); // zero-filled\n\n  bits.forEach((value, index) => {\n    const bytePos = Math.floor(index / 8);\n    const bitPos = index % 8; // eslint-disable-next-line no-bitwise\n\n    if (value) bytes[bytePos] |= 0b1 << 8 - 1 - bitPos;\n  });\n  return multisig_1.CompactBitArray.fromPartial({\n    elems: bytes,\n    extraBitsStored: extraBits\n  });\n}\n\nexports.makeCompactBitArray = makeCompactBitArray;\n\nfunction makeMultisignedTx(multisigPubkey, sequence, fee, bodyBytes, signatures) {\n  const addresses = Array.from(signatures.keys());\n  const prefix = encoding_1.Bech32.decode(addresses[0]).prefix;\n  const signers = Array(multisigPubkey.value.pubkeys.length).fill(false);\n  const signaturesList = new Array();\n\n  for (let i = 0; i < multisigPubkey.value.pubkeys.length; i++) {\n    const signerAddress = amino_1.pubkeyToAddress(multisigPubkey.value.pubkeys[i], prefix);\n    const signature = signatures.get(signerAddress);\n\n    if (signature) {\n      signers[i] = true;\n      signaturesList.push(signature);\n    }\n  }\n\n  const signerInfo = {\n    publicKey: proto_signing_1.encodePubkey(multisigPubkey),\n    modeInfo: {\n      multi: {\n        bitarray: makeCompactBitArray(signers),\n        modeInfos: signaturesList.map(_ => ({\n          single: {\n            mode: signing_1.SignMode.SIGN_MODE_LEGACY_AMINO_JSON\n          }\n        }))\n      }\n    },\n    sequence: long_1.default.fromNumber(sequence)\n  };\n  const authInfo = tx_1.AuthInfo.fromPartial({\n    signerInfos: [signerInfo],\n    fee: {\n      amount: [...fee.amount],\n      gasLimit: long_1.default.fromString(fee.gas)\n    }\n  });\n  const authInfoBytes = tx_1.AuthInfo.encode(authInfo).finish();\n  const signedTx = tx_2.TxRaw.fromPartial({\n    bodyBytes: bodyBytes,\n    authInfoBytes: authInfoBytes,\n    signatures: [multisig_1.MultiSignature.encode(multisig_1.MultiSignature.fromPartial({\n      signatures: signaturesList\n    })).finish()]\n  });\n  return signedTx;\n}\n\nexports.makeMultisignedTx = makeMultisignedTx;","map":{"version":3,"mappings":"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","names":["makeCompactBitArray","bits","byteCount","Math","ceil","length","extraBits","floor","bytes","Uint8Array","forEach","value","index","bytePos","bitPos","multisig_1","fromPartial","elems","extraBitsStored","exports","makeMultisignedTx","multisigPubkey","sequence","fee","bodyBytes","signatures","addresses","Array","from","keys","prefix","encoding_1","decode","signers","pubkeys","fill","signaturesList","i","signerAddress","amino_1","signature","get","push","signerInfo","publicKey","proto_signing_1","modeInfo","multi","bitarray","modeInfos","map","_","single","mode","signing_1","SIGN_MODE_LEGACY_AMINO_JSON","long_1","fromNumber","authInfo","tx_1","signerInfos","amount","gasLimit","fromString","gas","authInfoBytes","encode","finish","signedTx","tx_2"],"sourceRoot":"","sources":["../src/multisignature.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}